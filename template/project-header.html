{% from datetime import datetime %}
{% from HwWebUtil import ProjectStatus %}
<script>
$(function() {
    var dialog, form,
 
      origin_pass = $( "#origin_pass" ),
      new_pass = $( "#new_pass" ),
      new_pass_again = $( "#new_pass_again" ),
      allFields = $( [] ).add( origin_pass ).add( new_pass ).add( new_pass_again ),
      tips = $( ".validateTips" );
 
    function updateTips( t ) {
      tips
        .text( t )
        .addClass( "ui-state-highlight" );
      setTimeout(function() {
        tips.removeClass( "ui-state-highlight", 1500 );
      }, 500 );
    }
 
    function checkLength( o, n, min, max ) {
      if ( o.val().length > max || o.val().length < min ) {
      o.addClass( "ui-state-error" );
       updateTips( "长度必须在 " +
          min + "和" + max + "之间." );
        return false;
      } else {
        return true;
      }
    }
 
    function checkRegexp( o, regexp, n ) {
      if ( !( regexp.test( o.val() ) ) ) {
        o.addClass( "ui-state-error" );
        updateTips( n );
        return false;
      } else {
        return true;
      }
    }

function checkOriginNewPass( origin_pass, new_pass, n ) {
      if ( origin_pass.val() == new_pass_again.val()) {
        new_pass_again.addClass( "ui-state-error" );
        updateTips( n );
        return false;
      } else {
        return true;
      }
    }

    function checkTwoNewPass( new_pass, new_pass_again, n ) {
      if ( ! (new_pass.val() == new_pass_again.val()) ) {
        new_pass_again.addClass( "ui-state-error" );
        updateTips( n );
        return false;
      } else {
        return true;
      }
    }
 
    function modify_password() {
      var valid = true;
      allFields.removeClass( "ui-state-error" );
 
      valid = valid && checkLength( origin_pass, "origin_pass", 6, 15 );
      valid = valid && checkLength( new_pass, "new_pass", 6, 15 );
      valid = valid && checkLength( new_pass_again, "new_pass_again", 6, 15 );
 
      valid = valid && checkRegexp( origin_pass, /^([0-9a-zA-Z])+$/, "密码是6～15位的字母和数字组成的串" );
      valid = valid && checkRegexp( new_pass, /^([0-9a-zA-Z])+$/, "密码是6～15位的字母和数字组成的串" );
      valid = valid && checkRegexp( new_pass_again, /^([0-9a-zA-Z])+$/, "密码是6～15位的字母和数字组成的串" );
      valid = valid && checkOriginNewPass( origin_pass,new_pass , "新密码不能和旧密码一样" );
      valid = valid && checkTwoNewPass( new_pass,new_pass_again , "两次输入新密码不一" );
 
      if ( valid ) {
        $( "#form_modify_pass" ).submit();
      }
      return valid;
    }
    $( "#info-modify-button" ).on( "click", function() {
      event.preventDefault();
      modify_password()
    });
  });
  </script>
<div id="nav-panel" data-role="panel">
        <ul id="project_menu" data-role="listview" data-corners="false">
          <li><a href="/main" data-ajax="false">&lt;&lt;返回</a></li>
        {% for pro in projects %}
          {% if pro['status']  == ProjectStatus["UNPUBLISH"] %} 
            {% set statusStr = "实验未开始" %}
          {% elif pro['status']  == ProjectStatus["PUBLISH"]  and datetime.now() < datetime.strptime(pro["deadline"],"%Y-%m-%d %H:%M:%S")   %}
           {% set statusStr = "实验阶段" %}
          {% else %}
            {% set statusStr = "实验已结束" %}
          {% end %}
            <li><a href="/project/{{pro['pro_id']}}" data-ajax="false">{{pro['title']}} ({{statusStr}})</a></li>
        {% end %}
        </ul >
  </div>
  {% include "./header-password.html" %}

  <div id="person_status" data-role="header">
    <a href="#nav-panel" data-icon="bars">导航</a>
    <h1 id="header-title">第一次作业</h1>
    <a href="#nav-info-modify" data-icon="user" data-iconpos="right">{{info['name']}} &nbsp;&nbsp;{{info['userId'].upper()}}&nbsp;&nbsp;{{info['yearOfEntry']}}级&nbsp;&nbsp;{{info['classNo']}}班&nbsp;&nbsp;{{info['group']}}组&nbsp;&nbsp;</a>
  </div>