<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
{% from datetime import datetime %}
{% from HwWebUtil import QuizStatus %}
{% from HwWebUtil import QuesStatus %}
{% from HwWebUtil import QuizFlag %}
{% from HwWebUtil import QuizType %}
<head>
    <title>{{a_quiz["title"]}}</title>
{% include "./htmlhead.template" %}
    <script>
        $(document).ready(function(c) {
            $("input#submitButton").click(function(event){
                var r=confirm("提交后无法修改，确认提交？")
                if (r==false){
                    event.preventDefault();
                }
            });
            $("input#saveButton").click(function(e){
                $("form#quiz_form").attr("action","/quiz/{{ a_quiz['quiz_id'] }}/save");
            });
            {% if flag > QuizFlag["UNDONE"] %}
                {% for a_solution in user_quiz["solutions"] %}
                    {% if a_solution['solution'] %}  
                        {% if a_solution["type"] == 1 %}
                        $("input#{{a_solution["id"]}}_{{a_solution['solution'][0]}}").attr("checked", "checked");
                        {% elif a_solution["type"] == 2 %}
                            {% for a_ans in a_solution["solution"] %}
                                $("input#{{a_solution["id"]}}_{{a_ans}}").attr("checked", "checked");
                            {% end %}
                        {% else %}
                            $("textarea#{{a_solution["id"]}}_Text").val(unescapeHtml("{{a_solution['solution'][0]}}"));
                        {% end %}
                    {% end %}
                {% end %}
                {% if flag != QuizFlag["SAVE"]
                 %}
                    $("form#quiz_form input").button({ disabled: true });
                    $("form#quiz_form textarea").attr("disabled", "disabled");
                    {% if flag == QuizFlag["FULL_SCORED"] %}
                        $("#all_score").text("总得分: {{user_quiz['all_score']}}")
                        $("#all_score").css({"color":"red"})
                        {% for i in range(len(user_quiz["solutions"])) %}
                            var tmp = unescapeHtml("{{','.join(a_quiz['content'][i]['answer']) }}")
                            $("#answer_{{ user_quiz["solutions"][i]['id'] }}").text("标准答案：" + tmp + "(得分：{{user_quiz['solutions'][i]['score']}})");
                        {% end %}
                    {%elif flag == QuizFlag["SEMI_SCORED"] %}
                        $("#all_score").text("客观题得分: {{user_quiz['all_score']}}")
                        $("#all_score").css({"color":"red"})
                        {% for i in range(len(user_quiz["solutions"])) %}
                            {% if user_quiz['solutions'][i]["type"] != QuizType["ESSAYQUES"] %}
                                $("#answer_{{ user_quiz["solutions"][i]['id'] }}").text("标准答案：{{",".join(a_quiz['content'][i]['answer']) }}(得分：{{user_quiz['solutions'][i]['score']}})");
                            {% else %}
                                var tmp = unescapeHtml("{{','.join(a_quiz['content'][i]['answer']) }}")
                                $("#answer_{{ user_quiz["solutions"][i]['id'] }}").text("标准答案：" + tmp + "(得分：还未批改)");
                            {% end %}
                        {% end %}
                    {% end %}
                {% end %}
            {% elif flag == QuizFlag["BLANK"] %}
                $("form#quiz_form input").button({ disabled: true });
                $("form#quiz_form textarea").attr("disabled", "disabled");
                $("#all_score").text("截至日期前没有任何作业记录(总得分: 0),无法查看标准答案")
                $("#all_score").css({"color":"red"})
            {% else %}
            {% end %}
            {% if flag == QuizFlag["UNDONE"] or flag == QuizFlag["SAVE"] %}
                $("div#warn").text("请务必在截止日期前提交作业！暂存功能仅供下次继续做，并不能替代提交。提交后无法修改！")   
            {% elif flag == QuizFlag["SUB_NOTSCORED"]%}
                $("div#warn").text("作业已提交，还未批改")      
            {% end %}
        });
        </script>
</head>

<body>

{% include "./person_status.template" %}
<div id="container">
{% include "./navigator.template" %}

<div id="content">
        <form id="quiz_form" method="post" action="/quiz/{{ a_quiz['quiz_id'] }}/submit">
            <div id="quiz_info">
                <div id="quiz_title"><h4>Homework{{a_quiz["quiz_id"]}}&nbsp;&nbsp;{{a_quiz["title"]}}</h4></div>
                <div id="release_time" class="time">发布日期：{{  a_quiz['releaseTime'] }}</div>
                <div id="deadline" style="color:green" class="time">截止日期：{{  a_quiz['deadline']  }}</div>
                <div id="all_score"></div>
                <div id="warn"  style="color:red" class="warn"></div>

                <div  id="quiz_description">作业概述：{% raw a_quiz["description"] %}</div>
                
            </div>
            <div id="quiz_content">
                {% for a_ques in a_quiz["content"] %}
                    {% if a_ques["type"]  != QuizType["ESSAYQUES"] %}
                        <div class="quiz_choices"><p>{{a_ques['id']}}.&nbsp;{% raw a_ques["head"] %}</p>
                            <!-- <fieldset data-role="controlgroup">
                                <legend>{{a_ques['id']}}.&nbsp;{% raw a_ques["head"] %}</legend> -->
                            {% for a_choice in a_ques["choices"] %} 
                                    <input id="{{a_ques['id']}}_{{ a_choice['value'] }}" name="quiz_{{a_quiz['quiz_id']}}_{{a_ques['id']}}" type="radio" value="{{ a_choice['value'] }}" />
                                    <label for="{{a_ques['id']}}_{{ a_choice['value'] }}"> {{ a_choice["value"] }}.&nbsp;{% raw a_choice["text"] %}</label>
                            {% end %}
                            <!-- </fieldset> -->
                            <p height="15" id="answer_{{a_ques['id']}}"></p>
                        </div>
                    {% else %}
                        <div class="quiz_essay"><p>{{a_ques['id']}}.&nbsp;{% raw a_ques["head"] %}</p>
                            <textarea id="{{a_ques['id']}}_Text" name="quiz_{{a_quiz['quiz_id']}}_{{a_ques['id']}}"></textarea>
                            <p height="15" id="answer_{{a_ques['id']}}"></p>
                        </div>
                    {% end %}
                {% end %}
                <input id="saveButton" type="submit" name="saveButton" value="暂存作业"  />
                <input id="submitButton" type="submit" name="submitButton" value="提交作业" />
            </div>
        </form>
    </div>
</div>
<div class="footer">
        <p>中国科学院大学 版权所有 &copy;  2005-2014 地址: 北京市石景山区玉泉路19号(甲) 邮编: 100049</p>
</div>
</body>
<script>
  $(function() {
    $( "#saveButton").button()
    $( "#submitButton").button()
    $( ".quiz_choices").buttonset();
  });
  </script>
</html>

